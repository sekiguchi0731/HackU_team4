<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>おすすめのお店</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script>
    function getRecommendations() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function (position) {
                const lat = position.coords.latitude;
                const lng = position.coords.longitude;
                const category = document.getElementById("category").value || "ラーメン";

                // 現在時刻を HH:MM 形式にする
                const now = new Date();
                const timeString = now.getHours().toString().padStart(2, '0') + ':' +
                                   now.getMinutes().toString().padStart(2, '0');

                fetch(`/recommend?user_lat=${lat}&user_lng=${lng}&preferred_category=${category}&current_time=${timeString}`)
                    .then(response => response.json())
                    .then(data => {
                        const resultDiv = document.getElementById("results");
                        resultDiv.innerHTML = "<h4>おすすめのお店:</h4>";

                        if (data.recommendations.length === 0) {
                            resultDiv.innerHTML += "<p>おすすめできるお店が見つかりませんでした。</p>";
                        } else {
                            const ul = document.createElement("ul");
                            data.recommendations.forEach(shop => {
                                const li = document.createElement("li");
                                li.innerHTML = `
                                    <strong>${shop.name}</strong><br>
                                    総合スコア: ${shop.total_score.toFixed(2)}<br>
                                    カテゴリスコア: ${shop.category_score}<br>
                                    距離スコア: ${shop.distance_score}<br>
                                    営業時間スコア: ${shop.time_score}<br>
                                    空席スコア: ${shop.seat_score}<br><br>
                                `;
                                ul.appendChild(li);
                            });
                            resultDiv.appendChild(ul);
                        }
                    });
            }, function (error) {
                alert("位置情報の取得に失敗しました: " + error.message);
            });
        } else {
            alert("このブラウザは位置情報をサポートしていません。");
        }
    }
    </script>
</head>
<body class="bg-light">
<div class="container py-5">
    <h1 class="mb-4 text-center">現在地からおすすめのお店</h1>
    
    <div class="mb-3">
        <label for="category" class="form-label">カテゴリ（例: ラーメン, カフェ）</label>
        <input type="text" id="category" class="form-control" placeholder="カテゴリを入力">
    </div>

    <div class="text-center">
        <button class="btn btn-primary" onclick="getRecommendations()">おすすめを取得</button>
    </div>

    <div id="results" class="mt-4"></div>
</div>
</body>
</html>
